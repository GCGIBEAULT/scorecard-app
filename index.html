<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Scorecard App</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* minimal styles so page is usable without external file */
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding: 18px; max-width: 900px; margin: 0 auto; }
    #par-entry-grid { display: grid; grid-template-columns: repeat(9, 1fr); gap: 6px; padding: 8px 0; width: 100%; }
    .hole-wrapper { display:flex; flex-direction:column; align-items:center; }
    .par-input { width:100%; box-sizing:border-box; padding:6px; font-size:0.9rem; border:1px solid #ccc; border-radius:4px; transition: border-color .2s ease; }
    .par-input:focus { outline: none; border-color:#007bff; }
    .hole-block h2 { margin:0 0 8px 0; }
  </style>
</head>
<body>
  <h1>Start Your Round</h1>

  <div id="top-running-status" class="running-status even"></div>

  <label for="courseName"><strong>Course Name:</strong></label>
  <input type="text" id="courseName" placeholder="e.g. Fox Hollow" />
  <br/><br/>

  <label for="roundDate"><strong>Date:</strong></label>
  <input type="date" id="roundDate" />
  <br/><br/>

  <label for="handicap"><strong>Handicap:</strong></label>
  <input type="number" id="handicap" />
  <br/><br/>

  <div id="stat-selector">
    <strong>Select Stats to Track:</strong><br/>
    <label><input type="checkbox" value="score" checked/> Score</label>
    <label><input type="checkbox" value="putts" checked/> Putts</label>
    <label><input type="checkbox" value="gir" checked/> GIR</label>
    <label><input type="checkbox" value="fairway" checked/> Fairway</label>
    <br/><br/>
    <button onclick="startRound()">Start Round</button>
  </div>

  <section id="hole-view"></section>
  <section id="summary-block"></section>

  <script>
    let currentHole = 1;
    const totalHoles = 18;
    let selectedStats = [];
    const roundData = {};
    let playerHandicap = null;
    let courseName = "";
    let roundDate = "";
    let courseLayout = {};

    function startRound() {
      courseName = document.getElementById("courseName").value.trim();
      roundDate = document.getElementById("roundDate").value;
      const dateInput = document.getElementById("roundDate");
      if (dateInput && dateInput.value) {
        dateInput.blur();
        dateInput.dispatchEvent(new Event("change", { bubbles: true }));
      }
      playerHandicap = parseInt(document.getElementById("handicap").value, 10);
      selectedStats = Array.from(document.querySelectorAll("#stat-selector input:checked")).map(cb => cb.value);

      // Load saved layout for this course (if any)
      const savedLayoutRaw = localStorage.getItem(`layout_${courseName}`);
      courseLayout = savedLayoutRaw ? JSON.parse(savedLayoutRaw) : {};

      currentHole = 1;
      document.getElementById("stat-selector").style.display = "none";
      renderHole(currentHole);
    }

    function renderHole(hole) {
      const container = document.getElementById("hole-view");
      container.innerHTML = "";
      const holeBlock = document.createElement("div");
      holeBlock.className = "hole-block";
      holeBlock.innerHTML = `<h2>Hole ${hole}</h2>`;
      container.appendChild(holeBlock);

      // Only inject grid if layout is incomplete
      if (Object.keys(courseLayout).length < 18) {
        const grid = document.createElement("div");
        grid.id = "par-entry-grid";

        for (let i = 1; i <= 18; i++) {
          const wrapper = document.createElement("div");
          wrapper.className = "hole-wrapper";

          const input = document.createElement("input");
          input.type = "number";
          input.min = 3;
          input.max = 5;
          input.className = "par-input";
          input.name = `par${i}`;
          input.setAttribute("data-hole", String(i));
          input.autocomplete = "off";
          input.autocorrect = "off";
          input.autocapitalize = "off";
          input.spellcheck = false;
          input.inputMode = "numeric";

          // Use saved value if present; otherwise for first row (1..9) prefill the visible value to the hole number,
          // but keep it editable and allow onchange to overwrite and persist.
          if (courseLayout[i] !== undefined && courseLayout[i] !== null && courseLayout[i] !== "") {
            input.value = courseLayout[i];
          } else {
            // Only prefill visible value for first row to mirror 10-18 behavior and avoid autofill surprises.
            input.value = (i <= 9) ? String(i) : "";
          }

          input.placeholder = `${i}`;

          input.style.width = "100%";
          input.style.boxSizing = "border-box";
          input.style.padding = "6px";
          input.style.fontSize = "0.9rem";
          input.style.border = "1px solid #ccc";
          input.style.borderRadius = "4px";
          input.style.transition = "border-color 0.2s ease";

          input.onmouseover = () => input.style.borderColor = "#007bff";
          input.onmouseout = () => input.style.borderColor = "#ccc";

          input.onchange = () => {
            const val = parseInt(input.value, 10);
            if (!isNaN(val) && val >= 3 && val <= 5) {
              courseLayout[i] = val;
              // persist layout immediately
              if (courseName) {
                localStorage.setItem(`layout_${courseName}`, JSON.stringify(courseLayout));
              }
              if (i === hole) {
                const parLabel = document.querySelector(".hole-label");
                if (parLabel) parLabel.textContent = `Par ${val}`;
              }
              if (Object.keys(courseLayout).length === 18) {
                // full layout saved; re-render hole view
                grid.remove();
                document.getElementById("hole-view").innerHTML = "";
                renderHole(1);
              }
            } else {
              // invalid or cleared value: remove saved entry so it can be re-edited
              delete courseLayout[i];
              if (courseName) {
                localStorage.setItem(`layout_${courseName}`, JSON.stringify(courseLayout));
              }
            }
          };

          wrapper.appendChild(input);
          grid.appendChild(wrapper);
        }

        holeBlock.appendChild(grid);
      } else {
        // layout complete: you can render the normal hole UI here
        const done = document.createElement("div");
        done.textContent = "Course layout complete.";
        holeBlock.appendChild(done);
      }
    }

    // Optional helper: expose a debug function on window to inspect saved layouts
    window.debugLayouts = function() {
      return Object.keys(localStorage).filter(k => k.startsWith('layout_')).map(k => ({ k, v: JSON.parse(localStorage.getItem(k)) }));
    };

    // If you want the page to auto-start for quick testing, uncomment:
    // startRound();
  </script>
</body>
</html>
