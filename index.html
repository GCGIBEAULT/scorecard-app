<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scorecard App</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Start Your Round</h1>
<div id="top-running-status" class="running-status even"></div>

  <label for="courseName"><strong>Course Name:</strong></label>
  <input type="text" id="courseName" placeholder="e.g. Fox Hollow" />
  <br><br>

  <label for="roundDate"><strong>Date:</strong></label>
  <input type="date" id="roundDate" />
  <br><br>

  <label for="handicap"><strong>Handicap:</strong></label>
  <input type="number" id="handicap" />
  <br><br>

  <div id="stat-selector">
    <strong>Select Stats to Track:</strong><br>
    <label><input type="checkbox" value="score" checked /> Score</label>
    <label><input type="checkbox" value="putts" checked /> Putts</label>
    <label><input type="checkbox" value="gir" checked /> GIR</label>
    <label><input type="checkbox" value="fairway" checked /> Fairway</label>
    <br><br>
    <button onclick="startRound()">Start Round</button>
  </div>

  <section id="hole-view"></section>

  <script>
    let currentHole = 1;
    const totalHoles = 18;
    let selectedStats = [];
    const roundData = {};
    let playerHandicap = null;
    let courseName = "";
    let roundDate = "";
    let courseLayout = {};

   function startRound() {
  courseName = document.getElementById("courseName").value.trim();
  roundDate = document.getElementById("roundDate").value;
  const dateInput = document.getElementById("roundDate");
if (dateInput && dateInput.value) {
  dateInput.blur();
  dateInput.dispatchEvent(new Event("change", { bubbles: true }));
}
   
  playerHandicap = parseInt(document.getElementById("handicap").value, 10);
  selectedStats = Array.from(document.querySelectorAll("#stat-selector input:checked")).map(cb => cb.value);

  // Wipe ghost layout and reset
  if (courseName) localStorage.removeItem(`layout_${courseName}`);
  courseLayout = {};

  // Initialize round
  currentHole = 1;
  document.getElementById("stat-selector").style.display = "none";
  renderHole(currentHole);
}

function renderHole(hole) {
  const container = document.getElementById("hole-view");

  const holeBlock = document.createElement("div");
  holeBlock.className = "hole-block";
  holeBlock.innerHTML = `<h2>Hole ${hole}</h2>`;

if (hole === 1 || !courseLayout[hole]) {
const parInput = document.createElement("div");
parInput.innerHTML = `
  <label for="par${hole}"><strong>Par for Hole ${hole}:</strong></label>
  <input type="number" id="par${hole}" min="3" max="5" style="width: 50px;" value="" />
  <br><br>
`;
holeBlock.appendChild(parInput);

}

  selectedStats.forEach(stat => {
    const statBlock = document.createElement("div");
    statBlock.className = "stat-block";
    statBlock.innerHTML = `<strong>${stat}</strong><br>`;

    const options = getOptions(stat);
    options.forEach(opt => {
      const btn = document.createElement("button");
      btn.textContent = opt.label;
btn.onclick = () => {
  if (!roundData[hole]) roundData[hole] = {};
  roundData[hole][stat] = opt.value;

  // Clear previous selection for this stat
  Array.from(statBlock.querySelectorAll("button")).forEach(b => b.classList.remove("selected"));

  // Highlight the selected button
  btn.classList.add("selected");

  advanceStatOrHole(stat);
};

      statBlock.appendChild(btn);
    });

    holeBlock.appendChild(statBlock);
  });

  container.appendChild(holeBlock);
}
function advanceStatOrHole(lastStat) {
  const stats = selectedStats;
  const data = roundData[currentHole] || {};
  const entered = stats.filter(stat => data[stat] !== undefined);

  if (entered.length === stats.length) {
    if (!courseLayout[currentHole]) {
      const parInput = document.getElementById(`par${currentHole}`);
      const parValue = parseInt(parInput?.value);
      if (parValue) {
        courseLayout[currentHole] = parValue;
        localStorage.setItem(`layout_${courseName}`, JSON.stringify(courseLayout));
      }
    }

    localStorage.setItem("roundData", JSON.stringify(roundData));
    const container = document.getElementById("hole-view");
    container.innerHTML = "";

    currentHole++;
    if (currentHole === 10) {
      showSummary("front9");
    }

    if (currentHole <= totalHoles) {
      renderHole(currentHole);
    } else {
      showSummary("front9");
      showSummary("back9");
      showSummary("full");
    }
  }
}




  function getOptions(stat) {
  if (stat === "score") return [
    { label: "1", value: 1 },
    { label: "2", value: 2 },
    { label: "3", value: 3 },
    { label: "4", value: 4 },
    { label: "5", value: 5 },
    { label: "6", value: 6 },
    { label: "7", value: 7 },
    { label: "8", value: 8 }
  ];
  if (stat === "putts") return [
    { label: "0", value: 0 },
    { label: "1", value: 1 },
    { label: "2", value: 2 },
    { label: "3", value: 3 }
  ];
if (stat === "gir") return [
  { label: "Hit", value: true },
  { label: "X", value: false }
];

if (stat === "fairway") return [
  { label: "Hit", value: true },
  { label: "X", value: false }
];



return [];

}


function showSummary(scope = "full") {
  const container = document.getElementById("hole-view");
  let holes = [];

  if (scope === "front9") holes = Array.from({ length: 9 }, (_, i) => i + 1);
  else if (scope === "back9") holes = Array.from({ length: 9 }, (_, i) => i + 10);
  else holes = Array.from({ length: totalHoles }, (_, i) => i + 1);

  let totalScore = 0;
  let totalPar = 0;
  let summaryHTML = `
    <div class="summary-block">
      <h2>${scope === "front9" ? "Front 9" : scope === "back9" ? "Back 9" : "Full Round"} Summary</h2>
      <table>
        <thead>
          <tr><th>Hole</th><th>Par</th><th>Score</th><th>Putts</th><th>GIR</th><th>Fairway</th></tr>
        </thead>
        <tbody>
  `;

  holes.forEach(i => {
    const holeData = roundData[i] || {};
    const par = courseLayout[i] || "-";
    const score = holeData.score ?? "-";
    const putts = holeData.putts ?? "-";
    const gir = `<button class="stat-btn${holeData.gir === true ? ' selected' : ''}">${holeData.gir === true ? 'Hit' : 'X'}</button>`;
    const fairway = `<button class="stat-btn${holeData.fairway === true ? ' selected' : ''}">${holeData.fairway === true ? 'Hit' : 'X'}</button>`;

    if (typeof score === "number") totalScore += score;
    if (typeof par === "number") totalPar += par;

    summaryHTML += `
      <tr>
        <td>${i}</td>
        <td>${par}</td>
        <td>${score}</td>
        <td>${putts}</td>
        <td>${gir}</td>
        <td>${fairway}</td>
      </tr>
    `;
  });

  const diff = totalScore - totalPar;
  const overUnder = diff === 0 ? "Even" : diff > 0 ? `+${diff}` : `${diff}`;

summaryHTML += `
  </tbody>
</table>
<p><strong>Total Score:</strong> ${totalScore}</p>
<p><strong>Total Par:</strong> ${totalPar}</p>
<p><strong>Result:</strong> ${overUnder}</p>
</div>
`;

if (scope === "front9") {
  summaryHTML += `
    <button class="stat-btn" onclick="renderHole(10)">Play Back 9</button>
  `;
}

container.innerHTML += summaryHTML;

  </script>
</body>
</html>
