<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Golf Log</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    .summary-block { margin-top: 20px; border-top: 1px solid #ccc; padding-top: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    button.selected { background-color: #0077cc; color: white; }
  </style>
</head>
<body>
  <h1>Golf Round Tracker</h1>
  <div id="hole-view"></div>

  <script>
    let currentHole = 1;
    const totalHoles = 18;
    const courseName = "defaultCourse";
    const selectedStats = ["score", "putts", "gir", "fairway"];
    const roundData = JSON.parse(localStorage.getItem("roundData")) || {};
    const courseLayout = JSON.parse(localStorage.getItem(`layout_${courseName}`)) || {};

    function renderHole(hole) {
      const container = document.getElementById("hole-view");
      container.innerHTML = "";

      const holeBlock = document.createElement("div");
      holeBlock.innerHTML = `<h2>Hole ${hole}</h2><label>Par: <input type="number" id="par${hole}" value="${courseLayout[hole] || ''}" /></label>`;

      selectedStats.forEach(stat => {
        const statBlock = document.createElement("div");
        statBlock.id = `${stat}-block`;
        statBlock.innerHTML = `<h3>${stat}</h3>`;
        const options = getOptions(stat);

        options.forEach(opt => {
          const btn = document.createElement("button");
          btn.textContent = opt.label;
          btn.setAttribute("data-value", opt.value);
          btn.onclick = () => {
            if (!roundData[hole]) roundData[hole] = {};
            roundData[hole][stat] = opt.value;
            Array.from(statBlock.querySelectorAll("button")).forEach(b => b.classList.remove("selected"));
            btn.classList.add("selected");
            advanceStatOrHole(stat);
          };
          statBlock.appendChild(btn);
        });

        holeBlock.appendChild(statBlock);
      });

      container.appendChild(holeBlock);
    }

    function advanceStatOrHole(stat) {
      const holeData = roundData[currentHole] || {};
      const statBlock = document.getElementById(`${stat}-block`);
      const selectedBtn = statBlock.querySelector("button.selected");

      if (selectedBtn) {
        const value = selectedBtn.getAttribute("data-value");
        holeData[stat] = value === "true" ? true : value === "false" ? false : parseInt(value);
        roundData[currentHole] = holeData;
      }

      if (!courseLayout[currentHole]) {
        const parInput = document.getElementById(`par${currentHole}`);
        const parValue = parseInt(parInput?.value);
        if (parValue) {
          courseLayout[currentHole] = parValue;
          localStorage.setItem(`layout_${courseName}`, JSON.stringify(courseLayout));
        }
      }

      localStorage.setItem("roundData", JSON.stringify(roundData));

      const statIndex = selectedStats.indexOf(stat);
      if (statIndex < selectedStats.length - 1) return;

      currentHole++;
      const container = document.getElementById("hole-view");
      container.innerHTML = "";

      if (currentHole === 10) {
        showSummary("front9");
        const continueBtn = document.createElement("button");
        continueBtn.textContent = "Continue to Back 9";
        continueBtn.onclick = () => renderHole(currentHole);
        container.appendChild(continueBtn);
        return;
      }

      if (currentHole > totalHoles) {
        showSummary("front9");
        showSummary("back9");
        showSummary("full");

        const fileBtn = document.createElement("button");
        fileBtn.textContent = "File Round";
        fileBtn.onclick = () => alert("Round filed.");
        container.appendChild(fileBtn);
        return;
      }

      renderHole(currentHole);
    }

    function showSummary(scope = "full") {
      const container = document.getElementById("hole-view");
      let holes = [];

      if (scope === "front9") holes = Array.from({ length: 9 }, (_, i) => i + 1);
      else if (scope === "back9") holes = Array.from({ length: 9 }, (_, i) => i + 10);
      else holes = Array.from({ length: totalHoles }, (_, i) => i + 1);

      let totalScore = 0;
      let totalPar = 0;
      let summaryHTML = `
        <div class="summary-block">
          <h2>${scope === "front9" ? "Front 9" : scope === "back9" ? "Back 9" : "Full Round"} Summary</h2>
          <table>
            <thead>
              <tr><th>Hole</th><th>Par</th><th>Score</th><th>Putts</th><th>GIR</th><th>Fairway</th></tr>
            </thead>
            <tbody>
      `;

      holes.forEach(i => {
        const holeData = roundData[i] || {};
        const par = courseLayout[i] || "-";
        const score = holeData.score ?? "-";
        const putts = holeData.putts ?? "-";
        const gir = holeData.gir === true ? "Hit" : holeData.gir === false ? "X" : "-";
        const fairway = holeData.fairway === true ? "Hit" : holeData.fairway === false ? "X" : "-";

        if (typeof score === "number") totalScore += score;
        if (typeof par === "number") totalPar += par;

        summaryHTML += `
          <tr>
            <td>${i}</td>
            <td>${par}</td>
            <td>${score}</td>
            <td>${putts}</td>
            <td>${gir}</td>
            <td>${fairway}</td>
          </tr>
        `;
      });

      const diff = totalScore - totalPar;
      const overUnder = diff === 0 ? "Even" : diff > 0 ? `+${diff}` : `${diff}`;

      summaryHTML += `
            </tbody>
          </table>
          <p><strong>Total Score:</strong> ${totalScore}</p>
          <p><strong>Total Par:</strong> ${totalPar}</p>
          <p><strong>Result:</strong> ${overUnder}</p>
        </div>
      `;

      container.innerHTML += summaryHTML;
    }

    function getOptions(stat) {
      if (stat === "score") return [1, 2, 3, 4, 5, 6, 7, 8].map(n => ({ label: `${n}`, value: n }));
      if (stat === "putts") return [0, 1, 2, 3].map(n => ({ label: `${n}`, value: n }));
      if (stat === "gir") return [{ label: "Hit", value: true }, { label: "X", value: false }];
      if (stat === "fairway") return [{ label: "Hit", value: true }, { label: "X", value: false }];
      return [];
    }

    renderHole(currentHole);
  </script>
</body>
</html>
