<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scorecard App</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <h1>Start Your Round</h1>

  <label for="courseName"><strong>Course Name:</strong></label>
  <input type="text" id="courseName" placeholder="e.g. Fox Hollow" />
  <br><br>

  <label for="roundDate"><strong>Date:</strong></label>
  <input type="date" id="roundDate" />
  <br><br>

  <label for="handicap"><strong>Handicap:</strong></label>
  <input type="number" id="handicap" />
  <br><br>

  <div id="stat-selector">
    <strong>Select Stats to Track:</strong><br>
    <label><input type="checkbox" value="score" checked /> Score</label>
    <label><input type="checkbox" value="putts" checked /> Putts</label>
    <label><input type="checkbox" value="gir" checked /> GIR</label>
    <label><input type="checkbox" value="fairway" checked /> Fairway</label>
    <br><br>
<button id="start-button">Start Round</button>

  </div>
<div id="running-total" style="margin-bottom: 1em; font-weight: bold;"></div>

  <section id="hole-view"></section>

  <script>
    let currentHole = 1;
    const totalHoles = 18;
    let selectedStats = [];
    const roundData = {};
    let playerHandicap = null;
    let courseName = "";
    let roundDate = "";
    let courseLayout = {};

    function startRound() {
      courseName = document.getElementById("courseName").value.trim();
      roundDate = document.getElementById("roundDate").value;
      playerHandicap = parseInt(document.getElementById("handicap").value);
      selectedStats = Array.from(document.querySelectorAll("#stat-selector input:checked")).map(cb => cb.value);

      const savedLayout = localStorage.getItem(`layout_${courseName}`);
      if (savedLayout) {
        courseLayout = JSON.parse(savedLayout);
      }

      document.getElementById("stat-selector").style.display = "none";
      renderHole(currentHole);
    }

    function renderHole(hole) {
      const container = document.getElementById("hole-view");
      container.innerHTML = `<h2>Hole ${hole}</h2>`;

      if (!courseLayout[hole]) {
        const parInput = document.createElement("div");
        parInput.innerHTML = `
          <label for="par${hole}"><strong>Par for Hole ${hole}:</strong></label>
          <input type="number" id="par${hole}" min="3" max="5" style="width: 50px;" />
          <br><br>
        `;
        container.appendChild(parInput);
      }

      selectedStats.forEach(stat => {
        const statBlock = document.createElement("div");
        statBlock.className = "stat-block";
        statBlock.innerHTML = `<strong>${stat}</strong><br>`;
        const options = getOptions(stat);
        options.forEach(opt => {
          const btn = document.createElement("button");
          btn.textContent = opt.label;
          btn.onclick = () => {
            if (!roundData[hole]) roundData[hole] = {};
            roundData[hole][stat] = opt.value;
            advanceStatOrHole(stat);
          };
          statBlock.appendChild(btn);
        });
        container.appendChild(statBlock);
      });
    }

  function advanceStatOrHole(lastStat) {
  const statsEntered = Object.keys(roundData[currentHole] || {});
  if (statsEntered.length === selectedStats.length) {
    // Save par if not already stored
    if (!courseLayout[currentHole]) {
      const parInput = document.getElementById(`par${currentHole}`);
      const parValue = parseInt(parInput?.value);
      if (parValue) {
        courseLayout[currentHole] = parValue;
        localStorage.setItem(`layout_${courseName}`, JSON.stringify(courseLayout));
      }
    }

    // Update running total (starting at Hole 2)
    if (currentHole > 1) {
      let runningScore = 0;
      let runningPar = 0;

      for (let i = 1; i < currentHole; i++) {
        const score = roundData[i]?.score;
        const par = courseLayout[i];
        if (typeof score === "number") runningScore += score;
        if (typeof par === "number") runningPar += par;
      }

      const diff = runningScore - runningPar;
      const overUnder = diff === 0 ? "Even" : diff > 0 ? `+${diff}` : `${diff}`;
      document.getElementById("running-total").textContent = `Running Total: ${overUnder}`;
    }

    currentHole++;

    // Trigger Front 9 Summary after Hole 9
    if (currentHole === 10) {
      showFrontNineSummary();
    } else if (currentHole <= totalHoles) {
      renderHole(currentHole);
    } else {
      showSummary();
    }
  }
}

    function getOptions(stat) {
if (stat === "score") return [
  { label: "1", value: 1 },
  { label: "2", value: 2 },
  { label: "3", value: 3 },
  { label: "4", value: 4 },
  { label: "5", value: 5 },
  { label: "6", value: 6 },
  { label: "7", value: 7 },
  { label: "8", value: 8 }
];

      if (stat === "putts") return [{ label: "0", value: 0 }, { label: "1", value: 1 }, { label: "2", value: 2 }, { label: "3", value: 3 }];
if (stat === "gir") return [{ label: "Hit", value: true }];
if (stat === "fairway") return [{ label: "Hit", value: true }];

      return [];
    }

function showSummary() {
  const container = document.getElementById("hole-view");

  let frontScore = 0, backScore = 0;
  let frontPutts = 0, backPutts = 0;
  let frontGIR = 0, backGIR = 0;
  let frontFairway = 0, backFairway = 0;

  let summaryHTML = `
    <div id="summary-block">
      <h2>Final Round Summary</h2>
      <p><strong>Course:</strong> ${courseName}</p>
      <p><strong>Date:</strong> ${roundDate}</p>
      <p><strong>Handicap:</strong> ${playerHandicap}</p>
  `;

  const buildTable = (start, end, label) => {
    let scoreSum = 0, puttsSum = 0, girHits = 0, fairwayHits = 0;
    let html = `
      <h3>${label}</h3>
      <table>
        <thead>
          <tr>
            <th>Hole</th>
            <th>Score</th>
            <th>Putts</th>
            <th>GIR</th>
            <th>Fairway</th>
          </tr>
        </thead>
        <tbody>
    `;

    for (let i = start; i <= end; i++) {
      const hole = roundData[i] || {};
      const score = hole.score ?? "-";
      const putts = hole.putts ?? "-";
      const gir = hole.gir === true ? "âœ…" : "-";
      const fairway = hole.fairway === true ? "âœ…" : "-";

      if (typeof score === "number") scoreSum += score;
      if (typeof putts === "number") puttsSum += putts;
      if (hole.gir === true) girHits++;
      if (hole.fairway === true) fairwayHits++;

      html += `
        <tr>
          <td>${i}</td>
          <td>${score}</td>
          <td>${putts}</td>
          <td>${gir}</td>
          <td>${fairway}</td>
        </tr>
      `;
    }

    html += `
        </tbody>
      </table>
      <p><strong>Total Score:</strong> ${scoreSum}</p>
      <p><strong>Total Putts:</strong> ${puttsSum}</p>
      <p><strong>GIR Hits:</strong> ${girHits}</p>
      <p><strong>Fairway Hits:</strong> ${fairwayHits}</p>
    `;

    // Store for final combined summary
    if (start === 1) {
      frontScore = scoreSum;
      frontPutts = puttsSum;
      frontGIR = girHits;
      frontFairway = fairwayHits;
    } else {
      backScore = scoreSum;
      backPutts = puttsSum;
      backGIR = girHits;
      backFairway = fairwayHits;
    }

    return html;
  };

  summaryHTML += buildTable(1, 9, "Front 9");
  summaryHTML += buildTable(10, 18, "Back 9");

  const totalScore = frontScore + backScore;
  const totalPutts = frontPutts + backPutts;
  const totalGIR = frontGIR + backGIR;
  const totalFairway = frontFairway + backFairway;

summaryHTML += `
  <h3>Full Round Totals</h3>
  <p><strong>Total Score:</strong> ${totalScore}</p>
  <p><strong>Total Putts:</strong> ${totalPutts}</p>
  <p><strong>GIR Hits:</strong> ${totalGIR}</p>
  <p><strong>Fairway Hits:</strong> ${totalFairway}</p>

  <h3>Improve Your Game</h3>
  <div id="lesson-icons">
    <button onclick="showLesson('putts')">ðŸŸ¢ Putts</button>
    <button onclick="showLesson('gir')">ðŸ”µ GIR</button>
    <button onclick="showLesson('fairway')">ðŸŸ  Fairways</button>
    <button onclick="showLesson('sand')">ðŸŸ¤ Sand Play</button>
    <button onclick="showLesson('chip')">ðŸŸ£ Chipping</button>
  </div>
  <div id="lesson-drawer"></div>
`;
container.innerHTML = summaryHTML;
function showLesson(stat) {
  const drawer = document.getElementById("lesson-drawer");
  let lessons = [];

  if (stat === "putts") {
    lessons = [
      "Gate Drill for Alignment",
      "Lag Putting Distance Control",
      "Wrist Action Fixes",
      "Green Reading Basics",
      "Tempo and Rhythm",
      "Short Putt Confidence"
    ];
  } else if (stat === "gir") {
    lessons = [
      "Approach Shot Setup",
      "Club Selection Strategy",
      "Tempo for Mid Irons",
      "Par-3 Precision",
      "Target Visualization",
      "Avoiding Short-Side Misses"
    ];
  } else if (stat === "fairway") {
    lessons = [
      "Tee Height and Setup",
      "Driver Tempo Drill",
      "Fairway Wood Accuracy",
      "Grip Pressure Fixes",
      "Alignment Check",
      "Ball Position for Launch"
    ];
  } else if (stat === "sand") {
    lessons = [
      "Open Face Setup",
      "Splash Drill",
      "Low vs High Bunker Shots",
      "Weight Shift in Sand",
      "Club Selection",
      "Follow Through Finish"
    ];
  } else if (stat === "chip") {
    lessons = [
      "Landing Spot Visualization",
      "One-Club Chipping",
      "Low vs High Chips",
      "Backswing Length Control",
      "Bounce vs Dig",
      "Short Game Tempo"
    ];
  }

  drawer.innerHTML = `
    <h4>${stat.toUpperCase()} Lessons</h4>
    <ul>${lessons.map(l => `<li>${l}</li>`).join("")}</ul>
  `;
}

function showFrontNineSummary() {
  const container = document.getElementById("hole-view");
  let scoreSum = 0;
  let puttsSum = 0;
  let girHits = 0;
  let fairwayHits = 0;

  let summaryHTML = `
    <div id="front-nine-summary">
      <h2>Front 9 Summary</h2>
      <table>
        <thead>
          <tr>
            <th>Hole</th>
            <th>Score</th>
            <th>Putts</th>
            <th>GIR</th>
            <th>Fairway</th>
          </tr>
        </thead>
        <tbody>
  `;

  for (let i = 1; i <= 9; i++) {
    const hole = roundData[i] || {};
    const score = hole.score ?? "-";
    const putts = hole.putts ?? "-";
    const gir = hole.gir === true ? "âœ…" : "-";
    const fairway = hole.fairway === true ? "âœ…" : "-";

    if (typeof score === "number") scoreSum += score;
    if (typeof putts === "number") puttsSum += putts;
    if (hole.gir === true) girHits++;
    if (hole.fairway === true) fairwayHits++;

    summaryHTML += `
      <tr>
        <td>${i}</td>
        <td>${score}</td>
        <td>${putts}</td>
        <td>${gir}</td>
        <td>${fairway}</td>
      </tr>
    `;
  }

  summaryHTML += `
        </tbody>
      </table>
      <p><strong>Total Score:</strong> ${scoreSum}</p>
      <p><strong>Total Putts:</strong> ${puttsSum}</p>
      <p><strong>GIR Hits:</strong> ${girHits}</p>
      <p><strong>Fairway Hits:</strong> ${fairwayHits}</p>
      <button onclick="renderHole(10)">Continue to Back 9</button>
    </div>
  `;

  container.innerHTML = summaryHTML;
}

  </script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("start-button").addEventListener("click", startRound);
  });
</script>

</body>
</html>
